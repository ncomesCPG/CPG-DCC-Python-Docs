<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cpg.maya.rigging.frag.ribbon_component &mdash; CPG DCC Maya Python 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            CPG DCC Maya Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">cpg-maya</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">CPG DCC Maya Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cpg.maya.rigging.frag.ribbon_component</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cpg.maya.rigging.frag.ribbon_component</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ribbon rigging component. This is often driven with a ik/fk switching chain.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># System global imports</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c1"># python imports</span>
<span class="kn">import</span> <span class="nn">pymel.core</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="c1"># CPG python imports</span>
<span class="kn">from</span> <span class="nn">cpg.common.utils</span> <span class="kn">import</span> <span class="n">lists</span><span class="p">,</span> <span class="n">pymaths</span>
<span class="kn">from</span> <span class="nn">cpg.maya.utils</span> <span class="kn">import</span> <span class="n">attr_utils</span><span class="p">,</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">dag</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">naming</span>
<span class="kn">from</span> <span class="nn">cpg.maya.modifiers</span> <span class="kn">import</span> <span class="n">ma_decorators</span>
<span class="kn">from</span> <span class="nn">cpg.maya.modeling</span> <span class="kn">import</span> <span class="n">follicle</span>
<span class="kn">from</span> <span class="nn">cpg.maya.rigging</span> <span class="kn">import</span> <span class="n">chain_markup</span><span class="p">,</span> <span class="n">fk_chain</span><span class="p">,</span> <span class="n">ik_chain</span><span class="p">,</span> <span class="n">ik_utils</span><span class="p">,</span> <span class="n">ikfk_switch</span><span class="p">,</span> <span class="n">joint_utils</span><span class="p">,</span> <span class="n">ribbon_setup</span><span class="p">,</span> <span class="n">rig_utils</span>
<span class="kn">from</span> <span class="nn">cpg.maya.rigging.flags</span> <span class="kn">import</span> <span class="n">frag_flag</span>
<span class="c1"># Internal module imports</span>
<span class="kn">from</span> <span class="nn">cpg.maya.rigging.frag</span> <span class="kn">import</span> <span class="n">keyable_component</span>


<div class="viewcode-block" id="IKFKRibbonComponent"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.IKFKRibbonComponent">[docs]</a><span class="k">class</span> <span class="nc">IKFKRibbonComponent</span><span class="p">(</span><span class="n">keyable_component</span><span class="o">.</span><span class="n">KeyableComponent</span><span class="p">):</span>
    <span class="n">VERSION</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="IKFKRibbonComponent.create"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.IKFKRibbonComponent.create">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@ma_decorators</span><span class="o">.</span><span class="n">keep_namespace_decorator</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">frag_parent</span><span class="p">,</span>
               <span class="n">start_joint</span><span class="p">,</span>
               <span class="n">end_joint</span><span class="p">,</span>
               <span class="n">side</span><span class="p">,</span>
               <span class="n">region</span><span class="p">,</span>
               <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="n">ik_flag_orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">ik_flag_pv_orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">ik_flag_rotate_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">lock_child_rotate_axes</span><span class="o">=</span><span class="p">(),</span>
               <span class="n">lock_child_translate_axes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;ty&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">),</span>
               <span class="n">lock_root_translate_axes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;ty&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">),</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an ikfk component.</span>

<span class="sd">        :param FRAGNode frag_parent: FRAG Rig FRAGNode.</span>
<span class="sd">        :param pm.nt.Joint start_joint: Start joint of the chain.</span>
<span class="sd">        :param pm.nt.Joint end_joint: End joint of the chain.</span>
<span class="sd">        :param str side: The side in which the component is on the body.</span>
<span class="sd">        :param str region: The name of the region.  EX: &quot;Arm&quot;</span>
<span class="sd">        :return: Returns an instance of IKFKComponent.</span>
<span class="sd">        :rtype: IKFKComponent</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># serialize build kwargs for later.</span>
        <span class="n">kwargs_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs_dict</span><span class="p">[</span><span class="s1">&#39;ik_flag_orient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ik_flag_orient</span>
        <span class="n">kwargs_dict</span><span class="p">[</span><span class="s1">&#39;ik_flag_pv_orient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ik_flag_pv_orient</span>
        <span class="n">kwargs_dict</span><span class="p">[</span><span class="s1">&#39;ik_flag_rotate_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ik_flag_rotate_order</span>
        <span class="n">kwargs_dict</span><span class="p">[</span><span class="s1">&#39;lock_child_rotate_axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lock_child_rotate_axes</span>
        <span class="n">kwargs_dict</span><span class="p">[</span><span class="s1">&#39;lock_child_translate_axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lock_child_translate_axes</span>
        <span class="n">kwargs_dict</span><span class="p">[</span><span class="s1">&#39;lock_root_translate_axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lock_root_translate_axes</span>

        <span class="c1"># Set Namespace</span>
        <span class="n">root_namespace</span> <span class="o">=</span> <span class="n">frag_parent</span><span class="o">.</span><span class="n">namespace</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">root_namespace</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">keyable_component</span><span class="o">.</span><span class="n">KeyableComponent</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">frag_parent</span><span class="p">,</span>
                                                         <span class="n">IKFKRibbonComponent</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                                         <span class="n">IKFKRibbonComponent</span><span class="o">.</span><span class="n">VERSION</span><span class="p">,</span>
                                                         <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                                                         <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                                                         <span class="n">align_component</span><span class="o">=</span><span class="n">start_joint</span><span class="p">)</span>

        <span class="c1"># set serialized kwargs onto our network node we&#39;ll use this for serializing the exact build params.</span>
        <span class="n">attr_utils</span><span class="o">.</span><span class="n">set_compound_attribute_groups</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;buildKwargs&#39;</span><span class="p">,</span> <span class="n">kwargs_dict</span><span class="p">)</span>

        <span class="c1"># Get local level groups</span>
        <span class="n">flag_grp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">flagGroup</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">nt_grp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">noTouch</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">chain_between</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">get_between_nodes</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="n">end_joint</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">nt</span><span class="o">.</span><span class="n">Joint</span><span class="p">)</span>

        <span class="c1"># Create the ribbon drive chain</span>
        <span class="n">chain_ribbon</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_chain</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="n">end_joint</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;ribbon_chain&#39;</span><span class="p">)</span>
        <span class="n">chain_ribbon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>

        <span class="c1"># Attach ribbon drivers to original joints.</span>
        <span class="n">detail_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">original_joint</span><span class="p">,</span> <span class="n">chain_ribbon_joint</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain_between</span><span class="p">,</span> <span class="n">chain_ribbon</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">original_joint</span> <span class="o">!=</span> <span class="n">chain_between</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">chain_fk_result</span> <span class="o">=</span> <span class="n">fk_chain</span><span class="o">.</span><span class="n">fk_joint_chain</span><span class="p">(</span><span class="n">original_joint</span><span class="p">,</span>
                                                          <span class="n">original_joint</span><span class="p">,</span>
                                                          <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">*</span><span class="mf">.85</span><span class="p">,</span>
                                                          <span class="n">create_end_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">detail_flag</span> <span class="o">=</span> <span class="n">chain_fk_result</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">detail_flag</span><span class="o">.</span><span class="n">set_as_detail</span><span class="p">()</span>
                <span class="n">align_transform</span> <span class="o">=</span> <span class="n">detail_flag</span><span class="o">.</span><span class="n">get_align_transform</span><span class="p">()</span>
                <span class="n">align_transform</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">flag_grp</span><span class="p">)</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">chain_ribbon_joint</span><span class="p">,</span> <span class="n">align_transform</span><span class="p">)</span>
                <span class="n">detail_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail_flag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">constraint</span><span class="o">.</span><span class="n">point_constraint_safe</span><span class="p">(</span><span class="n">chain_ribbon_joint</span><span class="p">,</span> <span class="n">original_joint</span><span class="p">)</span>

        <span class="n">list_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain_ribbon</span><span class="p">)</span>

        <span class="n">ribbon_node</span> <span class="o">=</span> <span class="n">ribbon_setup</span><span class="o">.</span><span class="n">create_ribbon_along_nodes</span><span class="p">(</span><span class="n">chain_ribbon</span><span class="p">)</span>
        <span class="n">ribbon_group</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ribbon_group_</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">em</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ribbon_group</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="o">.</span><span class="n">getParent</span><span class="p">())</span>
        <span class="n">ribbon_node</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">ribbon_group</span><span class="p">)</span>
        <span class="n">ribbon_node</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ribbon_shape</span> <span class="o">=</span> <span class="n">ribbon_node</span><span class="o">.</span><span class="n">getShape</span><span class="p">()</span>

        <span class="c1"># create fk/ik joint chain based on ribbon chain</span>
        <span class="n">ribbon_start</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">chain_ribbon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;chain_ribbon_start&#39;</span><span class="p">)</span>
        <span class="n">ribbon_start</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">ribbon_mid</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">chain_ribbon</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">list_length</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="s1">&#39;chain_ribbon_mid&#39;</span><span class="p">)</span>
        <span class="n">ribbon_mid</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">ribbon_start</span><span class="p">)</span>
        <span class="n">ribbon_end</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">chain_ribbon</span><span class="p">[</span><span class="n">list_length</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;chain_ribbon_end&#39;</span><span class="p">)</span>
        <span class="n">ribbon_end</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">ribbon_mid</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">orient_constraint_safe</span><span class="p">(</span><span class="n">ribbon_end</span><span class="p">,</span> <span class="n">chain_between</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">ribbon_simp_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">]</span>

        <span class="n">pm</span><span class="o">.</span><span class="n">makeIdentity</span><span class="p">([</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># skin ribbon</span>
        <span class="n">skin_cluster_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">skinCluster</span><span class="p">(</span><span class="n">ribbon_node</span><span class="p">,</span> <span class="p">[</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">],</span> <span class="n">tsb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">normalizeWeights</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maximumInfluences</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="n">obeyMaxInfluences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeUnusedInfluence</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># add follicles and adjust the skin weights</span>
        <span class="n">follicle_group</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="s1">&#39;ribbon_follicles&#39;</span><span class="p">,</span> <span class="n">em</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">follicle_group</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">previous_v_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">joint_node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chain_ribbon</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_follicle</span> <span class="o">=</span> <span class="n">follicle</span><span class="o">.</span><span class="n">create_surface_follicle</span><span class="p">(</span><span class="n">ribbon_node</span><span class="p">,</span> <span class="n">hide_follicle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">v_pos</span> <span class="o">=</span> <span class="n">ribbon_shape</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;world&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">new_follicle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameterU</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>
            <span class="n">new_follicle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameterV</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">v_pos</span><span class="p">)</span>
            <span class="n">new_follicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">follicle_group</span><span class="p">)</span>
            <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">new_follicle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">joint_node</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">blend_joint</span> <span class="o">=</span> <span class="n">ribbon_start</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">list_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="n">ribbon_end</span>

            <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
                <span class="c1"># If not the first.</span>
                <span class="n">v_mid</span> <span class="o">=</span> <span class="n">previous_v_pos</span> <span class="o">+</span> <span class="p">(</span><span class="n">v_pos</span> <span class="o">-</span> <span class="n">previous_v_pos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">list_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">middle_influence</span> <span class="o">=</span> <span class="n">v_pos</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="n">blend_influence</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">middle_influence</span>

                    <span class="n">mid_middle_influence</span> <span class="o">=</span> <span class="n">v_mid</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="n">mid_blend_influence</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mid_middle_influence</span>
                    <span class="c1"># First Half</span>
                    <span class="c1"># Moving towards the mid joint</span>
                    <span class="n">mid_influence_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">mid_middle_influence</span><span class="p">),</span> <span class="p">(</span><span class="n">blend_joint</span><span class="p">,</span> <span class="n">mid_blend_influence</span><span class="p">)]</span>
                    <span class="n">influence_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">middle_influence</span><span class="p">),</span> <span class="p">(</span><span class="n">blend_joint</span><span class="p">,</span> <span class="n">blend_influence</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">middle_influence</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v_pos</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="n">blend_influence</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">middle_influence</span>

                    <span class="n">mid_middle_influence</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v_mid</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="n">mid_blend_influence</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mid_middle_influence</span>
                    <span class="c1"># Second Half</span>
                    <span class="c1"># Moving away frm the mid joint</span>
                    <span class="n">mid_influence_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">mid_middle_influence</span><span class="p">),</span> <span class="p">(</span><span class="n">blend_joint</span><span class="p">,</span> <span class="n">mid_blend_influence</span><span class="p">)]</span>
                    <span class="n">influence_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">middle_influence</span><span class="p">),</span> <span class="p">(</span><span class="n">blend_joint</span><span class="p">,</span> <span class="n">blend_influence</span><span class="p">)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
                <span class="c1"># If the first</span>
                <span class="n">influence_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">list_length</span><span class="p">:</span>
                <span class="c1"># If the last</span>
                <span class="n">influence_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ribbon_end</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">pm</span><span class="o">.</span><span class="n">skinPercent</span><span class="p">(</span><span class="n">skin_cluster_node</span><span class="p">,</span> <span class="n">ribbon_node</span><span class="o">.</span><span class="n">cv</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">index</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="n">transformValue</span><span class="o">=</span><span class="n">influence_list</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
                    <span class="n">pm</span><span class="o">.</span><span class="n">skinPercent</span><span class="p">(</span><span class="n">skin_cluster_node</span><span class="p">,</span> <span class="n">ribbon_node</span><span class="o">.</span><span class="n">cv</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">index</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">transformValue</span><span class="o">=</span><span class="n">mid_influence_list</span><span class="p">)</span>

            <span class="n">previous_v_pos</span> <span class="o">=</span> <span class="n">v_pos</span>

        <span class="c1"># Setup fk chain</span>
        <span class="n">chain_fk</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_chain</span><span class="p">(</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;fk_chain&#39;</span><span class="p">)</span>
        <span class="n">chain_fk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">chain_fk_result</span> <span class="o">=</span> <span class="n">fk_chain</span><span class="o">.</span><span class="n">fk_joint_chain</span><span class="p">(</span><span class="n">chain_fk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">chain_fk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="n">children_align_transforms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">create_end_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">offset_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Lock Attributes</span>
        <span class="n">fk_flags</span> <span class="o">=</span> <span class="n">chain_fk_result</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span>
        <span class="n">fk_flag_offset</span> <span class="o">=</span> <span class="n">chain_fk_result</span><span class="p">[</span><span class="s1">&#39;offset_flag&#39;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">keyable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelBox</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fk_flags</span><span class="p">]</span>

        <span class="n">attrs_to_lock</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sx&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">lock_root_translate_axes</span><span class="p">)</span>
        <span class="n">fk_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">(</span><span class="n">attrs_to_lock</span><span class="p">)</span>

        <span class="c1"># chain_ribbon.pop(0)</span>
        <span class="n">attrs_to_lock</span> <span class="o">=</span> <span class="n">attrs_to_lock</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">lock_child_rotate_axes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">lock_child_translate_axes</span><span class="p">)</span>
        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">(</span><span class="n">attrs_to_lock</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fk_flags</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">fk_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># Organize groups</span>
        <span class="n">start_flag</span> <span class="o">=</span> <span class="n">fk_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">flag_align_grp</span> <span class="o">=</span> <span class="n">start_flag</span><span class="o">.</span><span class="n">alignTransform</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">flag_align_grp</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">flag_grp</span><span class="p">)</span>
        <span class="n">chain_fk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>

        <span class="c1"># Create the IK Chain ########################</span>
        <span class="c1"># Duplicate chain and set up the fk chain</span>
        <span class="n">chain_ik</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_chain</span><span class="p">(</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;ik_chain&#39;</span><span class="p">)</span>
        <span class="n">chain_ik</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">chain_ik_result</span> <span class="o">=</span> <span class="n">ik_chain</span><span class="o">.</span><span class="n">ik_joint_chain</span><span class="p">(</span><span class="n">chain_ik</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">chain_ik</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                                                  <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                                                  <span class="n">ik_flag_orient</span><span class="o">=</span><span class="n">ik_flag_orient</span><span class="p">,</span>
                                                  <span class="n">ik_flag_pv_orient</span><span class="o">=</span><span class="n">ik_flag_pv_orient</span><span class="p">,</span>
                                                  <span class="n">ik_flag_rotate_order</span><span class="o">=</span><span class="n">ik_flag_rotate_order</span><span class="p">)</span>

        <span class="c1"># Edit results</span>
        <span class="n">ik</span> <span class="o">=</span> <span class="n">chain_ik_result</span><span class="p">[</span><span class="s1">&#39;ik_handle&#39;</span><span class="p">]</span>
        <span class="n">ik_align_group</span> <span class="o">=</span> <span class="n">chain_ik_result</span><span class="p">[</span><span class="s1">&#39;ik_zero&#39;</span><span class="p">]</span>
        <span class="n">ik_align_group</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">pv_flag</span> <span class="o">=</span> <span class="n">chain_ik_result</span><span class="p">[</span><span class="s1">&#39;pv_flag&#39;</span><span class="p">]</span>
        <span class="n">ik_flag</span> <span class="o">=</span> <span class="n">chain_ik_result</span><span class="p">[</span><span class="s1">&#39;ik_flag&#39;</span><span class="p">]</span>
        <span class="n">ik_flag_offset</span> <span class="o">=</span> <span class="n">chain_ik_result</span><span class="p">[</span><span class="s1">&#39;ik_flag_offset&#39;</span><span class="p">]</span>
        <span class="n">pv_line</span> <span class="o">=</span> <span class="n">chain_ik_result</span><span class="p">[</span><span class="s1">&#39;pv_line&#39;</span><span class="p">]</span>

        <span class="c1"># Transfer attributes</span>
        <span class="n">end_joint</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">))</span>
        <span class="n">end_joint</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span>
        <span class="n">end_joint</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;otherType&#39;</span><span class="p">,</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;otherType&#39;</span><span class="p">))</span>

        <span class="n">end_joint</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="n">ik_flag_offset</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">))</span>
        <span class="n">end_joint</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">ik_flag_offset</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span>
        <span class="n">end_joint</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;otherType&#39;</span><span class="p">,</span> <span class="n">ik_flag_offset</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;otherType&#39;</span><span class="p">))</span>

        <span class="n">pv_flag</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">))</span>
        <span class="n">pv_flag</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span>
        <span class="n">pv_flag</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;otherType&#39;</span><span class="p">,</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;otherType&#39;</span><span class="p">))</span>

        <span class="n">pv_flag</span><span class="o">.</span><span class="n">visibility</span> <span class="o">&gt;&gt;</span> <span class="n">pv_line</span><span class="o">.</span><span class="n">visibility</span>
        <span class="n">pv_flag</span><span class="o">.</span><span class="n">overrideVisibility</span> <span class="o">&gt;&gt;</span> <span class="n">pv_line</span><span class="o">.</span><span class="n">overrideVisibility</span>
        <span class="n">pv_flag</span><span class="o">.</span><span class="n">overrideEnabled</span> <span class="o">&gt;&gt;</span> <span class="n">pv_line</span><span class="o">.</span><span class="n">overrideEnabled</span>

        <span class="c1"># Create IKFK Switch</span>
        <span class="n">switch_joint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ribbon_simp_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">switch_joint</span> <span class="o">=</span> <span class="n">ribbon_simp_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ribbon_simp_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">switch_joint</span> <span class="o">=</span> <span class="n">ribbon_simp_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">ikfk_switch_result</span> <span class="o">=</span> <span class="n">ikfk_switch</span><span class="o">.</span><span class="n">ikfk_switch</span><span class="p">(</span><span class="n">switch_joint</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">invert_node</span> <span class="o">=</span> <span class="n">ikfk_switch_result</span><span class="p">[</span><span class="s1">&#39;invert_node&#39;</span><span class="p">]</span>
        <span class="n">switch_flag</span> <span class="o">=</span> <span class="n">ikfk_switch_result</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span>
        <span class="n">switch_attr_name</span> <span class="o">=</span> <span class="n">ikfk_switch_result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="c1"># visibility switching</span>
        <span class="n">invert_node</span><span class="o">.</span><span class="n">straight</span> <span class="o">&gt;&gt;</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">v</span>
        <span class="n">invert_node</span><span class="o">.</span><span class="n">straight</span> <span class="o">&gt;&gt;</span> <span class="n">ik_flag_offset</span><span class="o">.</span><span class="n">v</span>
        <span class="n">invert_node</span><span class="o">.</span><span class="n">straight</span> <span class="o">&gt;&gt;</span> <span class="n">pv_flag</span><span class="o">.</span><span class="n">v</span>
        <span class="k">for</span> <span class="n">fk_flag</span> <span class="ow">in</span> <span class="n">chain_fk_result</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]:</span>
            <span class="n">invert_node</span><span class="o">.</span><span class="n">inverse</span> <span class="o">&gt;&gt;</span> <span class="n">fk_flag</span><span class="o">.</span><span class="n">v</span>
            <span class="n">fk_flag</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="n">invert_node</span><span class="o">.</span><span class="n">inverse</span> <span class="o">&gt;&gt;</span> <span class="n">fk_flag_offset</span><span class="o">.</span><span class="n">v</span>

        <span class="c1"># Organize the groups</span>
        <span class="n">ik_align_grp</span> <span class="o">=</span> <span class="n">ik_flag</span><span class="o">.</span><span class="n">alignTransform</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">pv_align_grp</span> <span class="o">=</span> <span class="n">pv_flag</span><span class="o">.</span><span class="n">alignTransform</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">switch_align_grp</span> <span class="o">=</span> <span class="n">switch_flag</span><span class="o">.</span><span class="n">alignTransform</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">ik_align_group</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">pv_line</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">ribbon_group</span><span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">parent</span><span class="p">([</span><span class="n">ik_align_grp</span><span class="p">,</span> <span class="n">pv_align_grp</span><span class="p">,</span> <span class="n">switch_align_grp</span><span class="p">],</span> <span class="n">flag_grp</span><span class="p">)</span>

        <span class="c1"># visibility setting, allows pv line to be seen</span>
        <span class="n">chain_fk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">chain_ik</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># lock attributes</span>
        <span class="n">ik_flag</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">([</span><span class="s1">&#39;sx&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">])</span>
        <span class="n">ik_flag_offset</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">([</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;ty&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">,</span> <span class="s1">&#39;sx&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">])</span>
        <span class="n">pv_flag</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">([</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="s1">&#39;ry&#39;</span><span class="p">,</span> <span class="s1">&#39;rz&#39;</span><span class="p">,</span> <span class="s1">&#39;sx&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">])</span>
        <span class="n">switch_flag</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">([</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;ty&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="s1">&#39;ry&#39;</span><span class="p">,</span> <span class="s1">&#39;rz&#39;</span><span class="p">,</span> <span class="s1">&#39;sx&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">])</span>
        <span class="n">fk_flag_offset</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">([</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;ty&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">,</span> <span class="s1">&#39;sx&#39;</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">])</span>

        <span class="c1"># Meta Connections</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">chain_ik</span><span class="p">,</span> <span class="s1">&#39;ikChain&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">ik_flag</span><span class="p">,</span> <span class="s1">&#39;ikFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">ik_flag_offset</span><span class="p">,</span> <span class="s1">&#39;ikFlagOffset&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">pv_flag</span><span class="p">,</span> <span class="s1">&#39;pvFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">fk_flag_offset</span><span class="p">,</span> <span class="s1">&#39;fkFlagOffset&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">pv_line</span><span class="p">,</span> <span class="s1">&#39;pvLine&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">ik</span><span class="p">,</span> <span class="s1">&#39;ik_handle&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">addAttr</span><span class="p">(</span><span class="s1">&#39;switchAttrName&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;switchAttrName&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">switch_attr_name</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">switch_flag</span><span class="p">,</span> <span class="s1">&#39;switchFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">invert_node</span><span class="p">,</span> <span class="s1">&#39;invert_node&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="s1">&#39;start_joint&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">end_joint</span><span class="p">,</span> <span class="s1">&#39;end_joint&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">chain_between</span><span class="p">,</span> <span class="s1">&#39;bindJoints&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">chain_fk</span><span class="p">,</span> <span class="s1">&#39;fkChain&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">fk_flags</span><span class="p">,</span> <span class="s1">&#39;fkFlags&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">detail_flags</span><span class="p">,</span> <span class="s1">&#39;detailFlags&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>

        <span class="c1"># Make the ik joints and fk joints control the base joints</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ribbon_simp_list</span><span class="p">)):</span>
            <span class="n">orientConst</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">orientConstraint</span><span class="p">(</span><span class="n">chain_fk</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">chain_ik</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">ribbon_simp_list</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">pointConst</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">pointConstraint</span><span class="p">(</span><span class="n">chain_fk</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">chain_ik</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">ribbon_simp_list</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># IK</span>
            <span class="n">invert_node</span><span class="o">.</span><span class="n">straight</span> <span class="o">&gt;&gt;</span> <span class="n">orientConst</span><span class="o">.</span><span class="n">getWeightAliasList</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">invert_node</span><span class="o">.</span><span class="n">straight</span> <span class="o">&gt;&gt;</span> <span class="n">pointConst</span><span class="o">.</span><span class="n">getWeightAliasList</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># FK</span>
            <span class="n">invert_node</span><span class="o">.</span><span class="n">inverse</span> <span class="o">&gt;&gt;</span> <span class="n">orientConst</span><span class="o">.</span><span class="n">getWeightAliasList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">invert_node</span><span class="o">.</span><span class="n">inverse</span> <span class="o">&gt;&gt;</span> <span class="n">pointConst</span><span class="o">.</span><span class="n">getWeightAliasList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">node</span><span class="o">.</span><span class="n">set_scale</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="IKFKRibbonComponent.get_flags"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.IKFKRibbonComponent.get_flags">[docs]</a>    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fkFlags</span><span class="o">.</span><span class="n">listConnections</span><span class="p">()</span>
        <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ikFlag</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ikFlagOffset</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fkFlagOffset</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pvFlag</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">flags</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detailFlags</span><span class="o">.</span><span class="n">listConnections</span><span class="p">()</span>
        <span class="n">switch_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">switchFlag</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">switch_flag</span> <span class="ow">and</span> <span class="n">switch_flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">switch_flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fk_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fkFlags</span><span class="o">.</span><span class="n">listConnections</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ik_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ikFlag</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ikFlagOffset</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pvFlag</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">flags</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">detail_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detailFlags</span><span class="o">.</span><span class="n">listConnections</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ik_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ikFlag</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ik_flag_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ikFlagOffset</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fk_flag_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fkFlagOffset</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pv_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pvFlag</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">switch_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switchFlag</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

<div class="viewcode-block" id="IKFKRibbonComponent.attach_to_skeleton"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.IKFKRibbonComponent.attach_to_skeleton">[docs]</a>    <span class="k">def</span> <span class="nf">attach_to_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attach_skeleton_root</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drive the component with a given skeleton.</span>

<span class="sd">        :param Joint attach_skeleton_root: Top level joint of the hierarchy to drive the component.</span>
<span class="sd">        :param bool mo: If object offsets should be maintained.</span>
<span class="sd">        :return: A list of all created constraints.</span>
<span class="sd">        :rtype list[Constraint]:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">target_root_hierarchy</span> <span class="o">=</span> <span class="n">chain_markup</span><span class="o">.</span><span class="n">ChainMarkup</span><span class="p">(</span><span class="n">attach_skeleton_root</span><span class="p">)</span>
        <span class="n">constraint_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">fk_flag_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fk_flags</span>
        <span class="n">ik_flag_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ik_flag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv_flag</span><span class="p">]</span>
        <span class="n">detail_flag_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detail_flags</span>

        <span class="n">bind_joint_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bind_joints</span>

        <span class="n">skel_region</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">skel_side</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">bind_joint_list</span><span class="p">:</span>
            <span class="n">wrapped_node</span> <span class="o">=</span> <span class="n">chain_markup</span><span class="o">.</span><span class="n">JointMarkup</span><span class="p">(</span><span class="n">bind_joint_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">skel_region</span> <span class="o">=</span> <span class="n">wrapped_node</span><span class="o">.</span><span class="n">region</span>
            <span class="n">skel_side</span> <span class="o">=</span> <span class="n">wrapped_node</span><span class="o">.</span><span class="n">side</span>

        <span class="n">skel_region</span> <span class="o">=</span> <span class="n">skel_region</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
        <span class="n">skel_side</span> <span class="o">=</span> <span class="n">skel_side</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span>

        <span class="n">joint_list</span> <span class="o">=</span> <span class="n">target_root_hierarchy</span><span class="o">.</span><span class="n">get_full_chain</span><span class="p">(</span><span class="n">skel_region</span><span class="p">,</span> <span class="n">skel_side</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">joint_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">detail_flag</span><span class="p">,</span> <span class="n">joint_node</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">detail_flag_list</span><span class="p">,</span> <span class="n">joint_list</span><span class="p">):</span>
                <span class="n">constraint_node</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">detail_flag</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">constraint_node</span><span class="p">:</span>
                    <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint_node</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fk_flag_list</span><span class="p">:</span>
                <span class="n">fk_joint_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ikChain</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">fk_flag</span><span class="p">,</span> <span class="n">fk_joint</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fk_flag_list</span><span class="p">,</span> <span class="n">fk_joint_list</span><span class="p">):</span>
                    <span class="n">constraint_node</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">fk_joint</span><span class="p">,</span> <span class="n">fk_flag</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">constraint_node</span><span class="p">:</span>
                        <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint_node</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ik_flag_list</span><span class="p">:</span>
                <span class="c1"># ik constraints</span>
                <span class="n">constraint_node</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">joint_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ik_flag_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">constraint_node</span><span class="p">:</span>
                    <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint_node</span><span class="p">)</span>

                <span class="n">pv_locator</span> <span class="o">=</span> <span class="n">ik_utils</span><span class="o">.</span><span class="n">create_pole_vector_locator</span><span class="p">(</span><span class="n">joint_list</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">pv_locator</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">joint_list</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">joint_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
                <span class="n">pv_locator</span><span class="o">.</span><span class="n">addAttr</span><span class="p">(</span><span class="s1">&#39;bake_helper&#39;</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">constraint_node</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">pv_locator</span><span class="p">,</span> <span class="n">ik_flag_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">constraint_node</span><span class="p">:</span>
                    <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint_node</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">constraint_list</span></div>

<div class="viewcode-block" id="IKFKRibbonComponent.set_scale"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.IKFKRibbonComponent.set_scale">[docs]</a>    <span class="nd">@ma_decorators</span><span class="o">.</span><span class="n">keep_namespace_decorator</span>
    <span class="k">def</span> <span class="nf">set_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the inverse scale value to adjust the build group.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rig_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">()</span>
        <span class="n">frag_rig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frag_parent</span><span class="p">()</span>

        <span class="n">namespace</span><span class="o">.</span><span class="n">set_namespace</span><span class="p">(</span><span class="n">rig_namespace</span><span class="p">)</span>
        <span class="n">multi_node</span> <span class="o">=</span> <span class="n">lists</span><span class="o">.</span><span class="n">get_first_in_list</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rig_namespace</span><span class="si">}</span><span class="s1">:rig_scale_multi&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">pm</span><span class="o">.</span><span class="n">nt</span><span class="o">.</span><span class="n">MultiplyDivide</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">multi_node</span><span class="p">:</span>
            <span class="n">multi_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">nt</span><span class="o">.</span><span class="n">MultiplyDivide</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;rig_scale_multi&#39;</span><span class="p">)</span>

        <span class="n">multi_node</span><span class="o">.</span><span class="n">input1X</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">multi_node</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">multi_node</span><span class="o">.</span><span class="n">input2X</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">frag_rig</span><span class="o">.</span><span class="n">rigScale</span> <span class="o">&gt;&gt;</span> <span class="n">multi_node</span><span class="o">.</span><span class="n">input2X</span>

        <span class="n">ribbon_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pvLine</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">attr_utils</span><span class="o">.</span><span class="n">SCALE_ATTRS</span><span class="p">:</span>
            <span class="n">ribbon_grp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="n">ribbon_grp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
            <span class="n">multi_node</span><span class="o">.</span><span class="n">outputX</span> <span class="o">&gt;&gt;</span> <span class="n">ribbon_grp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="IKFKRibbonComponent.remove"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.IKFKRibbonComponent.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ribbon_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ribbon</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">delete</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">no_touch_grp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_group</span><span class="p">,</span> <span class="n">ribbon_grp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pynode</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="SplineIKRibbonComponent"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.SplineIKRibbonComponent">[docs]</a><span class="k">class</span> <span class="nc">SplineIKRibbonComponent</span><span class="p">(</span><span class="n">keyable_component</span><span class="o">.</span><span class="n">KeyableComponent</span><span class="p">):</span>
    <span class="n">VERSION</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="SplineIKRibbonComponent.create"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.SplineIKRibbonComponent.create">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@ma_decorators</span><span class="o">.</span><span class="n">keep_namespace_decorator</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">frag_parent</span><span class="p">,</span>
               <span class="n">start_joint</span><span class="p">,</span>
               <span class="n">end_joint</span><span class="p">,</span>
               <span class="n">side</span><span class="p">,</span>
               <span class="n">region</span><span class="p">,</span>
               <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an ikfk component.</span>

<span class="sd">        :param FRAGNode frag_parent: FRAG Rig FRAGNode.</span>
<span class="sd">        :param pm.nt.Joint start_joint: Start joint of the chain.</span>
<span class="sd">        :param pm.nt.Joint end_joint: End joint of the chain.</span>
<span class="sd">        :param str side: The side in which the component is on the body.</span>
<span class="sd">        :param str region: The name of the region.  EX: &quot;Arm&quot;</span>
<span class="sd">        :return: Returns an instance of IKFKComponent.</span>
<span class="sd">        :rtype: IKFKComponent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set Namespace</span>
        <span class="n">root_namespace</span> <span class="o">=</span> <span class="n">frag_parent</span><span class="o">.</span><span class="n">namespace</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="nb">set</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">root_namespace</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">keyable_component</span><span class="o">.</span><span class="n">KeyableComponent</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">frag_parent</span><span class="p">,</span>
                                                         <span class="n">SplineIKRibbonComponent</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                                         <span class="n">SplineIKRibbonComponent</span><span class="o">.</span><span class="n">VERSION</span><span class="p">,</span>
                                                         <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                                                         <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                                                         <span class="n">align_component</span><span class="o">=</span><span class="n">start_joint</span><span class="p">)</span>

        <span class="c1"># Get local level groups</span>
        <span class="n">flag_grp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">flagGroup</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">nt_grp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">noTouch</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">chain_between</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">get_between_nodes</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="n">end_joint</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">nt</span><span class="o">.</span><span class="n">Joint</span><span class="p">)</span>
        <span class="n">skel_hierarchy</span> <span class="o">=</span> <span class="n">chain_markup</span><span class="o">.</span><span class="n">ChainMarkup</span><span class="p">(</span><span class="n">start_joint</span><span class="o">.</span><span class="n">getParent</span><span class="p">())</span>

        <span class="n">wrapped_joint</span> <span class="o">=</span> <span class="n">chain_markup</span><span class="o">.</span><span class="n">JointMarkup</span><span class="p">(</span><span class="n">start_joint</span><span class="p">)</span>
        <span class="n">joint_side</span> <span class="o">=</span> <span class="n">wrapped_joint</span><span class="o">.</span><span class="n">side</span>
        <span class="n">joint_region</span> <span class="o">=</span> <span class="n">wrapped_joint</span><span class="o">.</span><span class="n">region</span>

        <span class="n">mid_helper_joint</span> <span class="o">=</span> <span class="n">skel_hierarchy</span><span class="o">.</span><span class="n">get_start</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">joint_region</span><span class="si">}</span><span class="s1">_mid&#39;</span><span class="p">,</span> <span class="n">joint_side</span><span class="p">)</span>
        <span class="n">rig_mid_helper_joint</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">mid_helper_joint</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_mid&#39;</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">rig_mid_helper_joint</span><span class="p">,</span> <span class="n">mid_helper_joint</span><span class="p">)</span>

        <span class="n">end_helper_joint</span> <span class="o">=</span> <span class="n">skel_hierarchy</span><span class="o">.</span><span class="n">get_start</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">joint_region</span><span class="si">}</span><span class="s1">_end&#39;</span><span class="p">,</span> <span class="n">joint_side</span><span class="p">)</span>
        <span class="n">rig_end_helper_joint</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">end_helper_joint</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_end&#39;</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">rig_end_helper_joint</span><span class="p">,</span> <span class="n">end_helper_joint</span><span class="p">)</span>

        <span class="n">primary_axis</span><span class="p">,</span> <span class="n">is_positive</span> <span class="o">=</span> <span class="n">rig_utils</span><span class="o">.</span><span class="n">find_primary_axis</span><span class="p">(</span><span class="n">chain_between</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Create the ribbon drive chain</span>
        <span class="n">ribbon_chain</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_chain</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="n">end_joint</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;ribbon_chain&#39;</span><span class="p">)</span>
        <span class="n">ribbon_chain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>

        <span class="n">splineik_chain</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_chain</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="n">end_joint</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;splineik_chain&#39;</span><span class="p">)</span>
        <span class="n">splineik_chain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>

        <span class="c1"># Attach ribbon drivers to original joints.</span>
        <span class="n">detail_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">original_joint</span><span class="p">,</span> <span class="n">ribbon_joint</span><span class="p">,</span> <span class="n">splineik_joint</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain_between</span><span class="p">,</span> <span class="n">ribbon_chain</span><span class="p">,</span> <span class="n">splineik_chain</span><span class="p">):</span>
            <span class="n">chain_fk_result</span> <span class="o">=</span> <span class="n">fk_chain</span><span class="o">.</span><span class="n">fk_joint_chain</span><span class="p">(</span><span class="n">original_joint</span><span class="p">,</span>
                                                      <span class="n">original_joint</span><span class="p">,</span>
                                                      <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">*</span><span class="mf">.85</span><span class="p">,</span>
                                                      <span class="n">create_end_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">detail_flag</span> <span class="o">=</span> <span class="n">chain_fk_result</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">detail_flag</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">(</span><span class="n">attr_utils</span><span class="o">.</span><span class="n">SCALE_ATTRS</span><span class="p">)</span>
            <span class="n">detail_flag</span><span class="o">.</span><span class="n">set_as_detail</span><span class="p">()</span>
            <span class="n">align_transform</span> <span class="o">=</span> <span class="n">detail_flag</span><span class="o">.</span><span class="n">get_align_transform</span><span class="p">()</span>
            <span class="n">align_transform</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">flag_grp</span><span class="p">)</span>
            <span class="c1"># constraint.parent_constraint_safe(splineik_joint, align_transform)</span>
            <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">detail_flag</span><span class="p">,</span> <span class="n">ribbon_joint</span><span class="p">)</span>
            <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">ribbon_joint</span><span class="p">,</span> <span class="n">original_joint</span><span class="p">)</span>
            <span class="n">detail_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail_flag</span><span class="p">)</span>

        <span class="n">list_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">)</span>

        <span class="n">ribbon_node</span> <span class="o">=</span> <span class="n">ribbon_setup</span><span class="o">.</span><span class="n">create_ribbon_along_nodes</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">)</span>
        <span class="n">ribbon_group</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ribbon_group_</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">em</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ribbon_group</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="o">.</span><span class="n">getParent</span><span class="p">())</span>
        <span class="n">ribbon_group</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ribbon_node</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">ribbon_group</span><span class="p">)</span>
        <span class="n">ribbon_shape</span> <span class="o">=</span> <span class="n">ribbon_node</span><span class="o">.</span><span class="n">getShape</span><span class="p">()</span>

        <span class="c1"># create fk/ik joint chain based on ribbon chain</span>
        <span class="n">ribbon_start</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;chain_ribbon_start&#39;</span><span class="p">)</span>
        <span class="n">ribbon_start</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">ribbon_mid</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">list_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)],</span> <span class="s1">&#39;chain_ribbon_mid&#39;</span><span class="p">)</span>
        <span class="n">ribbon_mid</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">rig_mid_helper_joint</span><span class="p">)</span>
        <span class="n">ribbon_end</span> <span class="o">=</span> <span class="n">joint_utils</span><span class="o">.</span><span class="n">duplicate_joint</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">[</span><span class="n">list_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;chain_ribbon_end&#39;</span><span class="p">)</span>
        <span class="n">ribbon_end</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">ribbon_end</span><span class="p">,</span> <span class="n">rig_end_helper_joint</span><span class="p">)</span>
        <span class="n">constraint</span><span class="o">.</span><span class="n">orient_constraint_safe</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">,</span> <span class="n">chain_between</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">ribbon_simp_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">]</span>

        <span class="n">pm</span><span class="o">.</span><span class="n">makeIdentity</span><span class="p">([</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># skin ribbon</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">skinCluster</span><span class="p">(</span><span class="n">ribbon_node</span><span class="p">,</span> <span class="n">splineik_chain</span><span class="p">,</span> <span class="n">tsb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">normalizeWeights</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maximumInfluences</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">obeyMaxInfluences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeUnusedInfluence</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># add follicles and adjust the skin weights</span>
        <span class="n">follicle_group</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="s1">&#39;ribbon_follicles&#39;</span><span class="p">,</span> <span class="n">em</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">follicle_group</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">detail_flag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ribbon_chain</span><span class="p">,</span> <span class="n">detail_flags</span><span class="p">)):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_follicle</span> <span class="o">=</span> <span class="n">follicle</span><span class="o">.</span><span class="n">create_surface_follicle</span><span class="p">(</span><span class="n">ribbon_node</span><span class="p">,</span> <span class="n">hide_follicle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">v_pos</span> <span class="o">=</span> <span class="n">ribbon_shape</span><span class="o">.</span><span class="n">closestPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;world&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">new_follicle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameterU</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>
            <span class="n">new_follicle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameterV</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">v_pos</span><span class="p">)</span>
            <span class="n">new_follicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">follicle_group</span><span class="p">)</span>
            <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">new_follicle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">detail_flag</span><span class="o">.</span><span class="n">get_align_transform</span><span class="p">(),</span> <span class="n">mo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># create curve</span>
        <span class="c1"># When generating the curve there are two additional points added approx 2/3 of the distance between the first</span>
        <span class="c1"># two and last two points</span>
        <span class="n">curve_pt_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">joint_node</span> <span class="ow">in</span> <span class="n">ribbon_simp_list</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">xform</span><span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">curve_pt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">v1</span> <span class="o">=</span> <span class="n">pymaths</span><span class="o">.</span><span class="n">sub_vectors</span><span class="p">(</span><span class="o">*</span><span class="nb">reversed</span><span class="p">(</span><span class="n">curve_pt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">v1_mod</span> <span class="o">=</span> <span class="n">pymaths</span><span class="o">.</span><span class="n">scale_vector</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="mf">.33</span><span class="p">)</span>
        <span class="n">v1_float</span> <span class="o">=</span> <span class="n">pymaths</span><span class="o">.</span><span class="n">add_vectors</span><span class="p">(</span><span class="n">curve_pt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1_mod</span><span class="p">)</span>
        <span class="n">curve_pt_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v1_float</span><span class="p">)</span>

        <span class="n">v2</span> <span class="o">=</span> <span class="n">pymaths</span><span class="o">.</span><span class="n">sub_vectors</span><span class="p">(</span><span class="o">*</span><span class="nb">reversed</span><span class="p">(</span><span class="n">curve_pt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>
        <span class="n">v2_mod</span> <span class="o">=</span> <span class="n">pymaths</span><span class="o">.</span><span class="n">scale_vector</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="mf">.666</span><span class="p">)</span>
        <span class="n">v2_float</span> <span class="o">=</span> <span class="n">pymaths</span><span class="o">.</span><span class="n">add_vectors</span><span class="p">(</span><span class="n">curve_pt_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">v2_mod</span><span class="p">)</span>
        <span class="n">curve_pt_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">v2_float</span><span class="p">)</span>

        <span class="c1"># for a deg 3 curve the first 3 knots and last 3 nots are repeated.</span>
        <span class="n">knot_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">spline_curve</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">curve</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_curve&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">curve_pt_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">knot_list</span><span class="p">)</span>
        <span class="c1"># If the rig is scaled we should not scale a driver object let it hang out with the ribbon.</span>
        <span class="n">spline_curve</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">ribbon_group</span><span class="p">)</span>

        <span class="c1"># setup spline IK</span>
        <span class="n">spline_ik_handle</span><span class="p">,</span> <span class="n">end_effector</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">ikHandle</span><span class="p">(</span><span class="n">sol</span><span class="o">=</span><span class="s1">&#39;ikSplineSolver&#39;</span><span class="p">,</span> <span class="n">ccv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">roc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pcv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                     <span class="n">startJoint</span><span class="o">=</span><span class="n">splineik_chain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">endEffector</span><span class="o">=</span><span class="n">splineik_chain</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                     <span class="n">curve</span><span class="o">=</span><span class="n">spline_curve</span><span class="p">)</span>
        <span class="n">spline_ik_handle</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_ikspline_handle&#39;</span><span class="p">)</span>
        <span class="n">spline_ik_handle</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">nt_grp</span><span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">ikHandle</span><span class="p">(</span><span class="n">spline_ik_handle</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;ikSplineSolver&#39;</span><span class="p">)</span>

        <span class="n">skin_cluster_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">skinCluster</span><span class="p">(</span><span class="n">spline_curve</span><span class="p">,</span> <span class="p">[</span><span class="n">ribbon_start</span><span class="p">,</span> <span class="n">ribbon_mid</span><span class="p">,</span> <span class="n">ribbon_end</span><span class="p">],</span> <span class="n">tsb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">normalizeWeights</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maximumInfluences</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="n">obeyMaxInfluences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removeUnusedInfluence</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># setup stretch</span>
        <span class="n">info_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s2">&quot;curveInfo&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_curve_info&#39;</span><span class="p">)</span>
        <span class="n">spline_curve</span><span class="o">.</span><span class="n">getShape</span><span class="p">()</span><span class="o">.</span><span class="n">worldSpace</span> <span class="o">&gt;&gt;</span> <span class="n">info_node</span><span class="o">.</span><span class="n">inputCurve</span>

        <span class="n">stretch_multi_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s2">&quot;multiplyDivide&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_multi_stretch&#39;</span><span class="p">)</span>
        <span class="n">stretch_multi_node</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;input2X&#39;</span><span class="p">,</span> <span class="n">info_node</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s1">&#39;arcLength&#39;</span><span class="p">))</span>
        <span class="n">info_node</span><span class="o">.</span><span class="n">arcLength</span> <span class="o">&gt;&gt;</span> <span class="n">stretch_multi_node</span><span class="o">.</span><span class="n">input1X</span>
        <span class="n">stretch_multi_node</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">joint_node</span> <span class="ow">in</span> <span class="n">splineik_chain</span><span class="p">:</span>
            <span class="n">multi_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s2">&quot;multiplyDivide&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">naming</span><span class="o">.</span><span class="n">get_basename</span><span class="p">(</span><span class="n">joint_node</span><span class="p">)</span><span class="si">}</span><span class="s1">_multi_stretch&#39;</span><span class="p">)</span>
            <span class="n">multi_node</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;input1X&#39;</span><span class="p">,</span> <span class="n">joint_node</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;t</span><span class="si">{</span><span class="n">primary_axis</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
            <span class="n">stretch_multi_node</span><span class="o">.</span><span class="n">outputX</span> <span class="o">&gt;&gt;</span> <span class="n">multi_node</span><span class="o">.</span><span class="n">input2X</span>
            <span class="n">multi_node</span><span class="o">.</span><span class="n">outputX</span> <span class="o">&gt;&gt;</span> <span class="n">joint_node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;t</span><span class="si">{</span><span class="n">primary_axis</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># setup primary controls</span>
        <span class="n">primary_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">joint_node</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ribbon_simp_list</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">]):</span>
            <span class="n">primary_flag</span> <span class="o">=</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">primary_flag</span><span class="o">.</span><span class="n">get_align_transform</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">flag_grp</span><span class="p">)</span>
            <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">primary_flag</span><span class="p">,</span> <span class="n">joint_node</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">primary_flag</span><span class="o">.</span><span class="n">lock_and_hide_attrs</span><span class="p">(</span><span class="n">attr_utils</span><span class="o">.</span><span class="n">SCALE_ATTRS</span><span class="p">)</span>
            <span class="n">primary_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">primary_flag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">joint_node</span> <span class="o">==</span> <span class="n">ribbon_simp_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">is_positive</span><span class="p">:</span>
                    <span class="n">joint_node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;r</span><span class="si">{</span><span class="n">primary_axis</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="n">spline_ik_handle</span><span class="o">.</span><span class="n">twist</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If we have a negative positive axis invert the twist rotation driver.</span>
                    <span class="n">multi_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s2">&quot;multiplyDivide&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">naming</span><span class="o">.</span><span class="n">get_basename</span><span class="p">(</span><span class="n">joint_node</span><span class="p">)</span><span class="si">}</span><span class="s1">_multi_twist&#39;</span><span class="p">)</span>
                    <span class="n">joint_node</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;r</span><span class="si">{</span><span class="n">primary_axis</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="n">multi_node</span><span class="o">.</span><span class="n">input2X</span>
                    <span class="n">multi_node</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s1">&#39;input1X&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">multi_node</span><span class="o">.</span><span class="n">outputX</span> <span class="o">&gt;&gt;</span> <span class="n">spline_ik_handle</span><span class="o">.</span><span class="n">twist</span>

        <span class="c1"># Meta Connections</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="s1">&#39;start_joint&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">end_joint</span><span class="p">,</span> <span class="s1">&#39;end_joint&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">chain_between</span><span class="p">,</span> <span class="s1">&#39;bindJoints&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">detail_flags</span><span class="p">,</span> <span class="s1">&#39;detailFlags&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">primary_flags</span><span class="p">,</span> <span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">ribbon_node</span><span class="p">,</span> <span class="s1">&#39;ribbon&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">connect_node</span><span class="p">(</span><span class="n">spline_ik_handle</span><span class="p">,</span> <span class="s1">&#39;ikHandle&#39;</span><span class="p">,</span> <span class="s1">&#39;fragParent&#39;</span><span class="p">)</span>

        <span class="n">node</span><span class="o">.</span><span class="n">set_scale</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="SplineIKRibbonComponent.get_flags"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.SplineIKRibbonComponent.get_flags">[docs]</a>    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pynode</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">flags</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pynode</span><span class="o">.</span><span class="n">detailFlags</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primary_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pynode</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">detail_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pynode</span><span class="o">.</span><span class="n">detailFlags</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">frag_flag</span><span class="o">.</span><span class="n">Flag</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>

<div class="viewcode-block" id="SplineIKRibbonComponent.attach_to_skeleton"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.SplineIKRibbonComponent.attach_to_skeleton">[docs]</a>    <span class="k">def</span> <span class="nf">attach_to_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attach_skeleton_root</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drive the component with a given skeleton.</span>

<span class="sd">        :param Joint attach_skeleton_root: Top level joint of the hierarchy to drive the component.</span>
<span class="sd">        :param bool mo: If object offsets should be maintained.</span>
<span class="sd">        :return: A list of all created constraints.</span>
<span class="sd">        :rtype list[Constraint]:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">target_root_hierarchy</span> <span class="o">=</span> <span class="n">chain_markup</span><span class="o">.</span><span class="n">ChainMarkup</span><span class="p">(</span><span class="n">attach_skeleton_root</span><span class="p">)</span>
        <span class="n">constraint_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">primary_flag_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
        <span class="n">detail_flag_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detail_flags</span>

        <span class="n">bind_joint_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bind_joints</span>

        <span class="n">skel_region</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">skel_side</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">bind_joint_list</span><span class="p">:</span>
            <span class="n">wrapped_node</span> <span class="o">=</span> <span class="n">chain_markup</span><span class="o">.</span><span class="n">JointMarkup</span><span class="p">(</span><span class="n">bind_joint_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">skel_region</span> <span class="o">=</span> <span class="n">wrapped_node</span><span class="o">.</span><span class="n">region</span>
            <span class="n">skel_side</span> <span class="o">=</span> <span class="n">wrapped_node</span><span class="o">.</span><span class="n">side</span>

        <span class="n">skel_region</span> <span class="o">=</span> <span class="n">skel_region</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
        <span class="n">skel_side</span> <span class="o">=</span> <span class="n">skel_side</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span>

        <span class="n">joint_list</span> <span class="o">=</span> <span class="n">target_root_hierarchy</span><span class="o">.</span><span class="n">get_full_chain</span><span class="p">(</span><span class="n">skel_region</span><span class="p">,</span> <span class="n">skel_side</span><span class="p">)</span>
        <span class="n">mid_helper_joint</span> <span class="o">=</span> <span class="n">target_root_hierarchy</span><span class="o">.</span><span class="n">get_full_chain</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">skel_region</span><span class="si">}</span><span class="s1">_mid&#39;</span><span class="p">,</span> <span class="n">skel_side</span><span class="p">)</span>
        <span class="n">end_helper_joint</span> <span class="o">=</span> <span class="n">target_root_hierarchy</span><span class="o">.</span><span class="n">get_full_chain</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">skel_region</span><span class="si">}</span><span class="s1">_end&#39;</span><span class="p">,</span> <span class="n">skel_side</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">joint_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">detail_flag</span><span class="p">,</span> <span class="n">joint_node</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">detail_flag_list</span><span class="p">,</span> <span class="n">joint_list</span><span class="p">):</span>
                <span class="n">constraint_node</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">joint_node</span><span class="p">,</span> <span class="n">detail_flag</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">constraint_node</span><span class="p">:</span>
                    <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint_node</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">primary_flag_list</span><span class="p">:</span>
            <span class="n">start_joint</span> <span class="o">=</span> <span class="n">bind_joint_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">start_joint</span><span class="p">,</span> <span class="n">primary_flag_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">))</span>
            <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">mid_helper_joint</span><span class="p">,</span> <span class="n">primary_flag_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">))</span>
            <span class="n">constraint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent_constraint_safe</span><span class="p">(</span><span class="n">end_helper_joint</span><span class="p">,</span> <span class="n">primary_flag_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mo</span><span class="o">=</span><span class="n">mo</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">constraint_list</span></div>

<div class="viewcode-block" id="SplineIKRibbonComponent.remove"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.SplineIKRibbonComponent.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ribbon_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ribbon</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">delete</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">no_touch_grp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_group</span><span class="p">,</span> <span class="n">ribbon_grp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pynode</span><span class="p">])</span></div>

<div class="viewcode-block" id="SplineIKRibbonComponent.set_scale"><a class="viewcode-back" href="../../../../../cpg.maya.rigging.frag.html#cpg.maya.rigging.frag.ribbon_component.SplineIKRibbonComponent.set_scale">[docs]</a>    <span class="nd">@ma_decorators</span><span class="o">.</span><span class="n">keep_namespace_decorator</span>
    <span class="k">def</span> <span class="nf">set_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the inverse scale value to adjust the build group.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rig_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">()</span>
        <span class="n">frag_rig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frag_parent</span><span class="p">()</span>

        <span class="n">namespace</span><span class="o">.</span><span class="n">set_namespace</span><span class="p">(</span><span class="n">rig_namespace</span><span class="p">)</span>
        <span class="n">multi_node</span> <span class="o">=</span> <span class="n">lists</span><span class="o">.</span><span class="n">get_first_in_list</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rig_namespace</span><span class="si">}</span><span class="s1">:rig_scale_multi&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">pm</span><span class="o">.</span><span class="n">nt</span><span class="o">.</span><span class="n">MultiplyDivide</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">multi_node</span><span class="p">:</span>
            <span class="n">multi_node</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">nt</span><span class="o">.</span><span class="n">MultiplyDivide</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;rig_scale_multi&#39;</span><span class="p">)</span>

        <span class="n">multi_node</span><span class="o">.</span><span class="n">input1X</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">multi_node</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">multi_node</span><span class="o">.</span><span class="n">input2X</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">frag_rig</span><span class="o">.</span><span class="n">rigScale</span> <span class="o">&gt;&gt;</span> <span class="n">multi_node</span><span class="o">.</span><span class="n">input2X</span>

        <span class="n">ribbon_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ribbon</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">attr_utils</span><span class="o">.</span><span class="n">SCALE_ATTRS</span><span class="p">:</span>
            <span class="n">ribbon_grp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="n">ribbon_grp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
            <span class="n">multi_node</span><span class="o">.</span><span class="n">outputX</span> <span class="o">&gt;&gt;</span> <span class="n">ribbon_grp</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Rigging Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>